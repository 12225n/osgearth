<!--
osgEarth Sample - ReadyMap.ORG Server - http://readymap.org

ReadyMap.ORG provides free global base map data for osgEarth developers!
This tiled, worldwide dataset of imagery, elevation, and street map data
is a great base map that provides global context for your own local datasets.
It works "out of the box" with osgEarth applications.

**** NOTICE ****
YOU ARE RESPONSIBLE for abiding by the TERMS AND CONDITIONS outlined at:
http://readymap.org

-->
<map name="ReadyMap.org">
    
    <TMSImage name="ReadyMap 15m Imagery">
        <url>http://readymap.org/readymap/tiles/1.0.0/7/</url>
    </TMSImage>

    <TMSElevation name="ReadyMap 90m Elevation" enabled="true">
        <url>http://readymap.org/readymap/tiles/1.0.0/116/</url>
        <vdatum>egm96</vdatum>
    </TMSElevation>

    <DebugImage/>
    
    <Decal name="Damage" 
           shared="true" 
           min_level="11" 
           shared_sampler="decal_tex" 
           shared_matrix="decal_mat"/>

    <xi:include href="viewpoints.xml"/>
    
    <terrainshader>
        <code>
          <![CDATA[
            #version 330
            #pragma vp_entryPoint destroy_vs
            #pragma vp_location vertex_model
            
            uniform sampler2D decal_tex;
            uniform mat4 decal_mat;
            
            vec4 oe_layer_tilec;
            vec3 vp_Normal;
            
            void destroy_vs(inout vec4 vertex)
            {
                const float maxdrop = -350.0;
                vec3 up = vp_Normal;
                vec2 uv = (decal_mat * oe_layer_tilec).st;
                vec4 texel = texture(decal_tex, uv);
                float damage = texel.a;
                vertex.xyz += up * maxdrop * damage;
            }            
          ]]>
        </code>
    </terrainshader>
</map>
