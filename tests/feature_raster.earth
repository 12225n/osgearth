<!--
osgEarth Sample - Raster to feature example.
-->

<map name="Demo: raster-to-feature">

    <xi:include href="readymap_elevation.xml"/>

    <libraries>osgEarthSplat</libraries>

    <image name="CLASSMAP" driver="landuse" shared="true" visible="false" coverage="true" max_data_level="15">
        <base_lod>12</base_lod>
        <tile_size>256</tile_size>
        <cache_policy usage="none"/>
        <images>
            <image name="ESA" driver="gdal" coverage="true">
                <url>H:/data/esa/GLOBCOVER_L4_200901_200912_V2.3_Ant_tiled.tif</url>
                <warp>0.01</warp>
                <profile>global-geodetic</profile>
            </image>
        </images>
        <shared_sampler> landUseTex       </shared_sampler>
        <shared_matrix>  landUseTexMatrix </shared_matrix>
    </image>

    <!-- Layer that extracts features from an image layer -->
    <ImageToFeature name="classmap_features">
        <image>CLASSMAP</image>
        <level>12</level>
        <attribute>value</attribute>
    </ImageToFeature>

    <FeatureModel name="trees" feature_source="classmap_features">

        <styles>                
            <style type="text/css">
                forest {
                   model:               "../data/tree.osg";
                   model-placement:     random;
                   model-density:       1000;
                   model-scale:         5.0;
                   altitude-clamping:   terrain;
                }  

                yellow {
                   stroke:             #ffff00;
                   stroke-width:       5px;
                }

                red {
                   stroke:             #ff0000;
                   stroke-width:       5px;
                }  

            </style>

            <selector name="default" style_expr="selectStyle()"/>

            <script language="javascript">
                <![CDATA[
                rotator = 0;
                function selectStyle() {
                    var value = parseFloat(feature.properties.value);
                    if (value >= 40.0 && value <= 100.0) return "forest";
                    return null;                    
                }
              ]]>
            </script>
        </styles>
    </FeatureModel>

    <xi:include href="readymap_imagery.xml"/>

    <viewpoints>            
        <viewpoint name="Trees 1">
            <heading>-66.2945</heading>
            <pitch>-14.0905</pitch>
            <range>3408.89m</range>
            <long>-121.7544800272052</long>
            <lat>46.7792209225515</lat>
            <height>1445.844014885835</height>
        </viewpoint>

        <viewpoint name="Trees 2">              
            <heading>12.2384</heading>
            <pitch>-4.26323</pitch>
            <range>1421.77m</range>
            <long>-121.8282019325911</long>
            <lat>46.65132101133439</lat>
            <height>1128.989560711198</height>
        </viewpoint>
    </viewpoints>

</map>
